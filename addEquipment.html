<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Equipment</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Add Equipment</h1>
    </header>
    <main>
        <form id="addEquipmentForm">
            <fieldset>
                <legend>Basic Information</legend>
                <label for="equipmentNo">Equipment no.:</label>
                <input type="text" id="equipmentNo" name="equipmentNo" required><br>

                <label for="serialNo">Serial No.:</label>
                <input type="text" id="serialNo" name="serialNo" required><br>

                <label for="sapNo">SAP No:</label>
                <input type="text" id="sapNo" name="sapNo" required><br>
            </fieldset>

            <fieldset>
                <legend>Model Information</legend>
                <label for="modelNo">Model No.:</label>
                <input type="text" id="modelNo" name="modelNo" required><br>

                <label for="manufacturer">Manufacturer:</label>
                <input type="text" id="manufacturer" name="manufacturer" required><br>
            </fieldset>

            <fieldset>
                <legend>Customs Information</legend>
                <label for="customsNo">Customs No.:</label>
                <input type="text" id="customsNo" name="customsNo" required><br>

                <label for="origin">Origin:</label>
                <input type="text" id="origin" name="origin" required><br>
            </fieldset>

            <fieldset>
                <legend>Calibration Information</legend>
                <label for="calibratedOn">Calibrated on:</label>
                <input type="date" id="calibratedOn" name="calibratedOn" required><br>

                <label for="cycleDuration">Cycle duration:</label>
                <input type="text" id="cycleDuration" name="cycleDuration" required><br>

                <label for="calibrationDueOn">Calibration due on:</label>
                <input type="date" id="calibrationDueOn" name="calibrationDueOn" required><br>
            </fieldset>

            <fieldset>
                <legend>Handover Information</legend>
                <label for="handoverTo">Handover to:</label>
                <input type="text" id="handoverTo" name="handoverTo" required><br>

                <label for="handoverDate">Handover date:</label>
                <input type="date" id="handoverDate" name="handoverDate" required><br>

                <label for="returnDate">Return date:</label>
                <input type="date" id="returnDate" name="returnDate" required><br>
            </fieldset>

            <fieldset>
                <legend>Storage Information</legend>
                <label for="warehouse">Warehouse:</label>
                <input type="text" id="warehouse" name="warehouse" required><br>

                <label for="storageLocation">Storage location:</label>
                <input type="text" id="storageLocation" name="storageLocation" required><br>
            </fieldset>

            <fieldset>
                <legend>Status Information</legend>
                <label for="calibrationStatus">Calibration status:</label>
                <input type="text" id="calibrationStatus" name="calibrationStatus" required><br>

                <label for="utilizationStatus">Utilization status:</label>
                <input type="text" id="utilizationStatus" name="utilizationStatus" required><br>
            </fieldset>

            <fieldset>
                <legend>Additional Information</legend>
                <label for="batteryType">Battery type:</label>
                <input type="text" id="batteryType" name="batteryType" required><br>

                <label for="weight">Weight (Kg):</label>
                <input type="text" id="weight" name="weight" required><br>

                <label for="imageLink">Image link:</label>
                <input type="text" id="imageLink" name="imageLink" oninput="updateImagePreview()"><br>

                <label for="comment">Comment:</label>
                <textarea id="comment" name="comment"></textarea><br>
            </fieldset>

            <fieldset>
                <legend>Image Preview</legend>
                <img id="imagePreview" src="" alt="Image preview will appear here" style="max-width: 100%; height: auto;">
            </fieldset>

            <button type="submit">Submit</button>
        </form>
    </main>
    <footer>
        <button onclick="window.history.back()">Go Back</button>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

        function getFirebaseConfig() {
            const config = localStorage.getItem('firebaseConfig');
            if (config) {
                return JSON.parse(config);
            } else {
                throw new Error('Firebase config not found');
            }
        }

        const firebaseConfig = getFirebaseConfig();
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        document.getElementById('addEquipmentForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            try {
                const newEquipmentRef = push(ref(db, 'equipment'));
                await set(newEquipmentRef, data);
                alert('Equipment added successfully');
                window.location.href = 'index.html'; // Redirect back to the main page
            } catch (error) {
                console.error('Error adding equipment:', error);
                alert('Failed to add equipment. Please try again.');
            }
        });

        window.updateImagePreview = function() {
            const imageLink = document.getElementById('imageLink').value;
            const imagePreview = document.getElementById('imagePreview');
            imagePreview.src = imageLink;
        }
    </script>
</body>
</html>
